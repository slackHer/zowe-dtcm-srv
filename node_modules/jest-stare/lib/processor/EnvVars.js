"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Logger_1 = require("../utils/Logger");
const EnvVarService_1 = require("../utils/EnvVarService");
class EnvVars {
    constructor(mEnvSrv = new EnvVarService_1.EnvVarService(EnvVars.ENV_PREFIX)) {
        this.mEnvSrv = mEnvSrv;
    }
    read() {
        const additionalResultsProcessorsValue = this.mEnvSrv.readEnvValue("ADDITIONAL_RESULTS_PROCESSORS");
        let additionalResultsProcessors;
        if (additionalResultsProcessorsValue != null) {
            try {
                additionalResultsProcessors = JSON.parse(additionalResultsProcessorsValue);
            }
            catch (e) {
                Logger_1.Logger.get.error("Could not parse additional results processors value." +
                    "It should be a JSON string of an array of strings, like the following: " +
                    JSON.stringify(["jest-html-reporter"]) + "\n You specified: " + additionalResultsProcessorsValue);
            }
        }
        return {
            resultDir: this.mEnvSrv.readEnvValue("RESULT_DIR"),
            resultJson: this.mEnvSrv.readEnvValue("RESULT_JSON"),
            resultHtml: this.mEnvSrv.readEnvValue("RESULT_HTML"),
            log: this.mEnvSrv.readBoolEnvValue("LOG"),
            jestStareConfigJson: this.mEnvSrv.readEnvValue("CONFIG_JSON"),
            jestGlobalConfigJson: this.mEnvSrv.readEnvValue("GLOBAL_CONFIG_JSON"),
            coverageLink: this.mEnvSrv.readEnvValue("COVERAGE_LINK"),
            report: this.mEnvSrv.readBoolEnvValue("REPORT"),
            additionalResultsProcessors,
            disableCharts: this.mEnvSrv.readBoolEnvValue("DISABLE_CHARTS"),
            hidePassing: this.mEnvSrv.readBoolEnvValue("HIDE_PASSING"),
            hideFailing: this.mEnvSrv.readBoolEnvValue("HIDE_FAILING")
        };
    }
    resolve(packageJsonConfig, envConfig) {
        const mergedConfig = {};
        if (envConfig.resultDir != null || packageJsonConfig.resultDir != null) {
            mergedConfig.resultDir = envConfig.resultDir == null ? packageJsonConfig.resultDir : envConfig.resultDir;
        }
        if (envConfig.resultJson != null || packageJsonConfig.resultJson != null) {
            mergedConfig.resultJson = envConfig.resultJson == null ? packageJsonConfig.resultJson : envConfig.resultJson;
        }
        if (envConfig.resultHtml != null || packageJsonConfig.resultHtml != null) {
            mergedConfig.resultHtml = envConfig.resultHtml == null ? packageJsonConfig.resultHtml : envConfig.resultHtml;
        }
        if (envConfig.log != null || packageJsonConfig.log != null) {
            mergedConfig.log = envConfig.log == null ? packageJsonConfig.log : envConfig.log;
        }
        if (envConfig.report != null || packageJsonConfig.report != null) {
            mergedConfig.report = envConfig.report == null ? packageJsonConfig.report : envConfig.report;
        }
        if (envConfig.jestStareConfigJson != null || packageJsonConfig.jestStareConfigJson != null) {
            mergedConfig.jestStareConfigJson =
                envConfig.jestStareConfigJson == null ? packageJsonConfig.jestStareConfigJson : envConfig.jestStareConfigJson;
        }
        if (envConfig.jestGlobalConfigJson != null || packageJsonConfig.jestGlobalConfigJson != null) {
            mergedConfig.jestGlobalConfigJson =
                envConfig.jestGlobalConfigJson == null ? packageJsonConfig.jestGlobalConfigJson : envConfig.jestGlobalConfigJson;
        }
        if (envConfig.coverageLink != null || packageJsonConfig.coverageLink != null) {
            mergedConfig.coverageLink = envConfig.coverageLink == null ? packageJsonConfig.coverageLink : envConfig.coverageLink;
        }
        if (envConfig.additionalResultsProcessors != null || packageJsonConfig.additionalResultsProcessors != null) {
            mergedConfig.additionalResultsProcessors =
                envConfig.additionalResultsProcessors == null ? packageJsonConfig.additionalResultsProcessors : envConfig.additionalResultsProcessors;
        }
        if (envConfig.disableCharts != null || packageJsonConfig.disableCharts != null) {
            mergedConfig.disableCharts =
                envConfig.disableCharts == null ? packageJsonConfig.disableCharts : envConfig.disableCharts;
        }
        if (envConfig.hidePassing != null || packageJsonConfig.hidePassing != null) {
            mergedConfig.hidePassing =
                envConfig.hidePassing == null ? packageJsonConfig.hidePassing : envConfig.hidePassing;
        }
        if (envConfig.hideFailing != null || packageJsonConfig.hideFailing != null) {
            mergedConfig.hideFailing =
                envConfig.hideFailing == null ? packageJsonConfig.hideFailing : envConfig.hideFailing;
        }
        return mergedConfig;
    }
}
EnvVars.ENV_PREFIX = "JEST_STARE_";
exports.EnvVars = EnvVars;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRW52VmFycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wcm9jZXNzb3IvRW52VmFycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLDRDQUF5QztBQUN6QywwREFBdUQ7QUFPdkQsTUFBYSxPQUFPO0lBY2hCLFlBQW9CLFVBQVUsSUFBSSw2QkFBYSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUM7UUFBL0MsWUFBTyxHQUFQLE9BQU8sQ0FBd0M7SUFBSSxDQUFDO0lBT2pFLElBQUk7UUFDUCxNQUFNLGdDQUFnQyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLCtCQUErQixDQUFDLENBQUM7UUFDcEcsSUFBSSwyQkFBcUMsQ0FBQztRQUMxQyxJQUFJLGdDQUFnQyxJQUFJLElBQUksRUFBRTtZQUMxQyxJQUFJO2dCQUNBLDJCQUEyQixHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsZ0NBQWdDLENBQUMsQ0FBQzthQUM5RTtZQUFDLE9BQU8sQ0FBQyxFQUFFO2dCQUNSLGVBQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLHNEQUFzRDtvQkFDbkUseUVBQXlFO29CQUN6RSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxHQUFHLG9CQUFvQixHQUFHLGdDQUFnQyxDQUFDLENBQUM7YUFDekc7U0FDSjtRQUNELE9BQU87WUFDSCxTQUFTLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDO1lBQ2xELFVBQVUsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUM7WUFDcEQsVUFBVSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FBQztZQUNwRCxHQUFHLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUM7WUFDekMsbUJBQW1CLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FB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